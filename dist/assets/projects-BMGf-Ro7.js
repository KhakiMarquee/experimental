import"./ui-CclVHjqH.js";import"./category-Bw-yP-ft.js";function R(r,w){r.classList.add("expanding");const y=r.getBoundingClientRect(),b=y.top+window.scrollY,u=y.left+window.scrollX,a=y.width,d=y.height;r.style.transition="none",r.style.position="fixed",r.style.top=`${b}px`,r.style.left=`${u}px`,r.style.width=`${a}px`,r.style.height=`${d}px`,r.style.margin="0",r.style.transform="none",r.style.zIndex="10000",r.style.willChange="top,left,width,height,transform",document.body.appendChild(r),r.getBoundingClientRect();const h=600;r.style.transition=`top ${h}ms ease, left ${h}ms ease, width ${h}ms ease, height ${h}ms ease, transform ${h}ms ease`,r.style.top="0px",r.style.left="0px",r.style.width="100vw",r.style.height="100vh",r.classList.add("fullscreen");const l=O=>{O.target===r&&r.classList.contains("fullscreen")&&(r.removeEventListener("transitionend",l),r.style.willChange="",D(w))};r.addEventListener("transitionend",l),setTimeout(()=>{document.body.contains(r)&&D(w)},h+50)}function D(r){document.body.innerHTML=`
<div id="detail-app">
  <button id="close-detail" aria-label="Close" style="align-self:flex-end; font-size:1.25rem; background:none; border:none; cursor:pointer;">✕</button>
  <main style="max-width:960px; width:100%; margin:0 auto;">
    <h1 style="margin:0 0 12px 0;">${r.title}</h1>
    <p style="margin:0 0 8px 0;"><strong>Client:</strong> ${r.client??""}</p>
    <p style="margin:0 0 8px 0;"><strong>Theme:</strong> ${r.theme??""}</p>
    <p style="margin:0 0 8px 0;"><strong>Type:</strong> ${Array.isArray(r.type)?r.type.join(", "):r.type??""}</p>
    <p style="margin:0 0 16px 0;">${r.description??""}</p>

    <!-- Prefer video embed, fallback to main image -->
    ${r.video?`<div style="position:relative; padding-bottom:56.25%; height:0; overflow:hidden; margin-bottom:16px;">
           <iframe src="${r.video.replace("youtu.be/","www.youtube.com/embed/").replace("watch?v=","embed/")}" 
                   frameborder="0" 
                   allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                   allowfullscreen 
                   style="position:absolute; top:0; left:0; width:100%; height:100%;">
           </iframe>
         </div>`:r.image?`<img src="${r.image}" alt="${r.title}" style="max-width:100%; height:auto; display:block; margin-bottom:16px;">`:""}

    <!-- Grid of extra images -->
    ${r.imageStack&&r.imageStack.length?`<div style="display:grid; grid-template-columns:repeat(auto-fit,minmax(200px,1fr)); gap:12px; margin-top:16px;">
           ${r.imageStack.map(w=>`
             <img src="${w}" alt="${r.title}" style="width:100%; height:auto; border-radius:8px; object-fit:cover;">
           `).join("")}
         </div>`:""}
  </main>
</div>
  `,document.getElementById("close-detail").addEventListener("click",()=>{location.reload()})}var S={exports:{}},B={exports:{}},T;function z(){return T||(T=1,function(r,w){(function(y,b){r.exports=b()})(window,function(){return function(y){var b={};function u(a){if(b[a])return b[a].exports;var d=b[a]={i:a,l:!1,exports:{}};return y[a].call(d.exports,d,d.exports,u),d.l=!0,d.exports}return u.m=y,u.c=b,u.d=function(a,d,h){u.o(a,d)||Object.defineProperty(a,d,{enumerable:!0,get:h})},u.r=function(a){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(a,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(a,"__esModule",{value:!0})},u.t=function(a,d){if(1&d&&(a=u(a)),8&d||4&d&&typeof a=="object"&&a&&a.__esModule)return a;var h=Object.create(null);if(u.r(h),Object.defineProperty(h,"default",{enumerable:!0,value:a}),2&d&&typeof a!="string")for(var l in a)u.d(h,l,(function(O){return a[O]}).bind(null,l));return h},u.n=function(a){var d=a&&a.__esModule?function(){return a.default}:function(){return a};return u.d(d,"a",d),d},u.o=function(a,d){return Object.prototype.hasOwnProperty.call(a,d)},u.p="",u(u.s=0)}([function(y,b,u){u.r(b);var a=window,d=/^image\//,h=/\.\w+$/,l={},O={file:null,quality:.8,convertSize:2048e3,loose:!0,redressOrientation:!0},f=function(e){return typeof e=="function"},I=function(e){return d.test(e)};function C(e){e=Object.assign({},O,e),this.options=e,this.file=e.file,this.image=null,this.ParsedOrientationInfo=null,this.init()}var x=C.prototype;for(var U in b.default=C,x.init=function(){var e=this,i=this.file,n=this.options;i&&I(i.type)?(I(n.mimeType)||(n.mimeType=i.type),l.file2Image(i,function(t){f(e.beforeCompress)&&(e.image=t,i.width=t.naturalWidth,i.height=t.naturalHeight,e.beforeCompress(i)),i.type==="image/jpeg"&&n.redressOrientation?e.getParsedOrientationInfo(function(s){e.parsedOrientationInfo=s,e.rendCanvas()}):(e.parsedOrientationInfo={rotate:0,scaleX:1,scaleY:1},e.rendCanvas())},e.error)):e.error("请上传图片文件!")},x.rendCanvas=function(){var e=this,i=this.options,n=this.image,t=this.getExpectedEdge(),s=t.dWidth,c=t.dHeight,g=t.width,o=t.height,p=l.image2Canvas(n,s,c,e.beforeDraw.bind(e),e.afterDraw.bind(e),g,o);l.canvas2Blob(p,function(m){m&&(m.width=p.width,m.height=p.height),e.success(m)},i.quality,i.mimeType)},x.beforeCompress=function(){f(this.options.beforeCompress)&&this.options.beforeCompress(this.file)},x.getExpectedEdge=function(){var e,i=this.image,n=this.parsedOrientationInfo.rotate,t=this.options,s=i.naturalWidth,c=i.naturalHeight,g=Math.abs(n)%180==90;g&&(e=c,c=s,s=e);var o=s/c,p=Math.max(t.maxWidth,0)||1/0,m=Math.max(t.maxHeight,0)||1/0,v=Math.max(t.minWidth,0)||0,L=Math.max(t.minHeight,0)||0,j=Math.max(t.width,0)||s,E=Math.max(t.height,0)||c;p<1/0&&m<1/0?m*o>p?m=p/o:p=m*o:p<1/0?m=p/o:m<1/0&&(p=m*o),v>0&&L>0?L*o>v?L=v/o:v=L*o:v>0?L=v/o:L>0&&(v=L*o),E*o>j?E=j/o:j=E*o;var $=j=Math.floor(Math.min(Math.max(j,v),p)),M=E=Math.floor(Math.min(Math.max(E,L),m));return g&&(e=M,M=$,$=e),{dWidth:$,dHeight:M,width:j,height:E}},x.getParsedOrientationInfo=function(e){var i=this;this.getOrientation(function(n){f(e)&&e(i.parseOrientation(n))})},x.getOrientation=function(e){var i=this;l.file2ArrayBuffer(this.file,function(n){f(e)&&e(i.resetAndGetOrientation(n))})},x.resetAndGetOrientation=function(e){var i,n=new DataView(e);try{var t,s,c;if(n.getUint8(0)===255&&n.getUint8(1)===216)for(var g=n.byteLength,o=2;o+1<g;){if(n.getUint8(o)===255&&n.getUint8(o+1)===225){s=o;break}o+=1}if(s){var p=s+4,m=s+10;if(l.getStringFromCharCode(n,p,4)==="Exif"){var v=n.getUint16(m);if(((t=v===18761)||v===19789)&&n.getUint16(m+2,t)===42){var L=n.getUint32(m+4,t);L>=8&&(c=m+L)}}}if(c){var j;for(g=n.getUint16(c,t),j=0;j<g;j+=1)if(o=c+12*j+2,n.getUint16(o,t)===274){o+=8,i=n.getUint16(o,t),n.setUint16(o,1,t);break}}}catch(E){console.error(E),i=1}return i},x.parseOrientation=function(e){var i=0,n=1,t=1;switch(e){case 2:n=-1;break;case 3:i=-180;break;case 4:t=-1;break;case 5:i=90,t=-1;break;case 6:i=90;break;case 7:i=90,n=-1;break;case 8:i=-90}return{rotate:i,scaleX:n,scaleY:t}},x.beforeDraw=function(e,i){var n=this.parsedOrientationInfo,t=n.rotate,s=n.scaleX,c=n.scaleY,g=this.file,o=this.options,p="transparent",m=i.width,v=i.height;switch(g.size>o.convertSize&&o.mimeType==="image/png"&&(p="#fff",o.mimeType="image/jpeg"),e.fillStyle=p,e.fillRect(0,0,m,v),f(o.beforeDraw)&&o.beforeDraw.call(this,e,i),e.save(),t){case 90:e.translate(m,0);break;case-90:e.translate(0,v);break;case-180:e.translate(m,v)}e.rotate(t*Math.PI/180),e.scale(s,c)},x.afterDraw=function(e,i){var n=this.options;f(n.afterDraw)&&n.afterDraw.call(this,e,i)},x.error=function(e){var i=this.options;if(!f(i.error))throw new Error(e);i.error.call(this,e)},x.success=function(e){var i,n,t=this.options,s=this.file,c=this.image,g=this.getExpectedEdge(),o=c.naturalHeight,p=c.naturalWidth;if(e&&e.size)if(!t.loose&&e.size>s.size&&!(g.width>p||g.height>o))console.warn("当前设置的是非宽松模式，压缩结果大于源图片，输出源图片"),e=s;else{var m=new Date;e.lastModified=m.getTime(),e.lastModifiedDate=m,e.name=s.name,e.name&&e.type!==s.type&&(e.name=e.name.replace(h,(i=e.type,(n=I(i)?i.substr(6):"")==="jpeg"&&(n="jpg"),"."+n)))}else console.warn("图片压缩出了点意外，输出源图片"),e=s;f(t.success)&&t.success.call(this,e)},l.file2DataUrl=function(e,i,n){var t=new FileReader;t.onload=function(){i(t.result)},t.onerror=function(){f(n)&&n("读取文件失败！")},t.readAsDataURL(e)},l.file2ArrayBuffer=function(e,i,n){var t=new FileReader;t.onload=function(s){i(s.target.result)},t.onerror=function(){f(n)&&n("读取文件失败！")},t.readAsArrayBuffer(e)},l.getStringFromCharCode=function(e,i,n){var t,s="";for(n+=i,t=i;t<n;t+=1)s+=String.fromCharCode(e.getUint8(t));return s},l.file2Image=function(e,i,n){var t=new Image,s=a.URL||a.webkitURL;if(a.navigator&&/(?:iPad|iPhone|iPod).*?AppleWebKit/i.test(a.navigator.userAgent)&&(t.crossOrigin="anonymous"),t.alt=e.name,t.onerror=function(){f(n)&&n("图片加载错误！")},s){var c=s.createObjectURL(e);t.onload=function(){i(t),s.revokeObjectURL(c)},t.src=c}else this.file2DataUrl(e,function(g){t.onload=function(){i(t)},t.src=g},n)},l.url2Image=function(e,i,n){var t=new Image;t.src=e,t.onload=function(){i(t)},t.onerror=function(){f(n)&&n("图片加载错误！")}},l.image2Canvas=function(e,i,n,t,s,c,g){var o=document.createElement("canvas"),p=o.getContext("2d");return o.width=c||e.naturalWidth,o.height=g||e.naturalHeight,f(t)&&t(p,o),p.save(),p.drawImage(e,0,0,i,n),p.restore(),f(s)&&s(p,o),o},l.canvas2DataUrl=function(e,i,n){return e.toDataURL(n||"image/jpeg",i)},l.dataUrl2Image=function(e,i,n){var t=new Image;t.onload=function(){i(t)},t.error=function(){f(n)&&n("图片加载错误！")},t.src=e},l.dataUrl2Blob=function(e,i){for(var n=e.split(",")[1],t=e.match(/^data:(.*?)(;base64)?,/)[1],s=atob(n),c=n.length,g=new Uint8Array(c),o=0;o<c;o++)g[o]=s.charCodeAt(o);return new Blob([g],{type:i||t})},l.blob2DataUrl=function(e,i,n){this.file2DataUrl(e,i,n)},l.blob2Image=function(e,i,n){this.file2Image(e,i,n)},l.canvas2Blob=function(e,i,n,t){var s=this;HTMLCanvasElement.prototype.toBlob||Object.defineProperty(HTMLCanvasElement.prototype,"toBlob",{value:function(c,g,o){var p=this.toDataURL(g,o);c(s.dataUrl2Blob(p))}}),e.toBlob(function(c){i(c)},t||"image/jpeg",n||.8)},l.upload=function(e,i,n){var t=new XMLHttpRequest,s=new FormData;s.append("file",i),t.onreadystatechange=function(){if(t.readyState!==4||t.status!==200)throw new Error(t);n&&n(t.responseText)},t.open("POST",e,!0),t.send(s)},l)l.hasOwnProperty(U)&&(C[U]=l[U])}]).default})}(B)),B.exports}var k;function P(){return k||(k=1,S.exports=z()),S.exports}var H=P();function A(){return new URLSearchParams(window.location.search).get("category")}function q(r,w){const y=document.getElementById("content"),b=document.getElementById("page-title"),u=document.getElementById("project-section-description");fetch(w).then(a=>{if(!a.ok)throw new Error("Failed to fetch data.");return a.json()}).then(a=>{const d=a[r];if(!d)throw new Error(`Category "${r}" not found in data.`);b.textContent=r.charAt(0).toUpperCase()+r.slice(1),u&&(u.textContent=d.description||""),y.innerHTML="";const h=d.items;h&&h.length?h.forEach((l,O)=>{const f=document.createElement("div");f.classList.add("project-row"),f.innerHTML=`
            <div class="project-image">
              <img src="${l.image}" alt="${l.title}">
            </div>
            <div class="project-details">
              <p>${l.title}</p>
              <span class="project-client">${l.client||""}</span>
              <div class="project-meta">
                <p class="project-theme">${l.theme||""}</p>
                <p class="project-description">${l.description||""}</p>   
                <span class="project-type">${l.type?l.type.join(", "):""}</span>
              </div>
            </div>
          `,y.appendChild(f),console.log(`Rendering entry #${O}, applying compression.`);const I=f.querySelector(".project-image img");if(I.crossOrigin="anonymous",!I){console.warn("No image element found in section:",f);return}console.log("Processing image:",I.src),fetch(I.src,{mode:"cors"}).then(C=>(console.log("Fetched image blob"),C.blob())).then(C=>{console.log("Blob ready, size:",C.size);const U={file:new File([C],"image.jpg",{type:C.type}),quality:.6,convertSize:1/0,redressOrientation:!0,beforeCompress(e){console.log("BeforeCompress:",e.size,e.type)},success(e){console.log("Compression success:",e.size,e.type),I.src=URL.createObjectURL(e);const i=(originalSize-compressedSize)/originalSize*100;console.log("Original size:",originalSize,"bytes"),console.log("Compressed size:",compressedSize,"bytes"),console.log("Compression reduced size by:",i.toFixed(2)+"%")},error(e){console.error("Compression error:",e)}};new H.ImageCompressor(U)}).catch(C=>console.error("Fetch error during compression:",C)),f.addEventListener("click",()=>{R(f,l)})}):y.innerHTML=`<p>No content found for "${r}".</p>`}).catch(a=>{console.error("Error:",a),y.innerHTML="<p>Error loading content.</p>"})}document.addEventListener("DOMContentLoaded",()=>{const r=A();r?q(r,"/data/data.json"):document.getElementById("content").innerHTML="<p>Invalid category.</p>",document.getElementById("grid-view").addEventListener("click",()=>{const w=document.querySelector(".projects-container");w.classList.add("row-view"),w.classList.remove("list-view"),document.getElementById("grid-view").classList.add("active"),document.getElementById("list-view").classList.remove("active")}),document.getElementById("list-view").addEventListener("click",()=>{const w=document.querySelector(".projects-container");w.classList.add("list-view"),w.classList.remove("row-view"),document.getElementById("list-view").classList.add("active"),document.getElementById("grid-view").classList.remove("active")})});
