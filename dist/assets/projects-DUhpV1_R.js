import"./ui-CclVHjqH.js";import"./category-Bw-yP-ft.js";function R(r,E){r.classList.add("expanding");const y=r.getBoundingClientRect(),m=y.top+window.scrollY,c=y.left+window.scrollX,a=y.width,p=y.height;r.style.transition="none",r.style.position="fixed",r.style.top=`${m}px`,r.style.left=`${c}px`,r.style.width=`${a}px`,r.style.height=`${p}px`,r.style.margin="0",r.style.transform="none",r.style.zIndex="10000",r.style.willChange="top,left,width,height,transform",document.body.appendChild(r),r.getBoundingClientRect();const v=600;r.style.transition=`top ${v}ms ease, left ${v}ms ease, width ${v}ms ease, height ${v}ms ease, transform ${v}ms ease`,r.style.top="0px",r.style.left="0px",r.style.width="100vw",r.style.height="100vh",r.classList.add("fullscreen");const l=U=>{U.target===r&&r.classList.contains("fullscreen")&&(r.removeEventListener("transitionend",l),r.style.willChange="",B(E))};r.addEventListener("transitionend",l),setTimeout(()=>{document.body.contains(r)&&B(E)},v+50)}function B(r){document.body.innerHTML=`
<div id="detail-app">
  <button id="close-detail" aria-label="Close" style="align-self:flex-end; font-size:1.25rem; background:none; border:none; cursor:pointer;">✕</button>
  <main style="max-width:960px; width:100%; margin:0 auto;">
    <h1 style="margin:0 0 12px 0;">${r.title}</h1>
    <p style="margin:0 0 8px 0;"><strong>Client:</strong> ${r.client??""}</p>
    <p style="margin:0 0 8px 0;"><strong>Theme:</strong> ${r.theme??""}</p>
    <p style="margin:0 0 8px 0;"><strong>Type:</strong> ${Array.isArray(r.type)?r.type.join(", "):r.type??""}</p>
    <p style="margin:0 0 16px 0;">${r.description??""}</p>

    <!-- Prefer video embed, fallback to main image -->
    ${r.video?`<div style="position:relative; padding-bottom:56.25%; height:0; overflow:hidden; margin-bottom:16px;">
           <iframe src="${r.video.replace("youtu.be/","www.youtube.com/embed/").replace("watch?v=","embed/")}" 
                   frameborder="0" 
                   allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                   allowfullscreen 
                   style="position:absolute; top:0; left:0; width:100%; height:100%;">
           </iframe>
         </div>`:r.image?`<img src="${r.image}" alt="${r.title}" style="max-width:100%; height:auto; display:block; margin-bottom:16px;">`:""}

    <!-- Grid of extra images -->
    ${r.imageStack&&r.imageStack.length?`<div style="display:grid; grid-template-columns:repeat(auto-fit,minmax(200px,1fr)); gap:12px; margin-top:16px;">
           ${r.imageStack.map(E=>`
             <img src="${E}" alt="${r.title}" style="width:100%; height:auto; border-radius:8px; object-fit:cover;">
           `).join("")}
         </div>`:""}
  </main>
</div>
  `,document.getElementById("close-detail").addEventListener("click",()=>{location.reload()})}var k={exports:{}},S={exports:{}},T;function P(){return T||(T=1,function(r,E){(function(y,m){r.exports=m()})(window,function(){return function(y){var m={};function c(a){if(m[a])return m[a].exports;var p=m[a]={i:a,l:!1,exports:{}};return y[a].call(p.exports,p,p.exports,c),p.l=!0,p.exports}return c.m=y,c.c=m,c.d=function(a,p,v){c.o(a,p)||Object.defineProperty(a,p,{enumerable:!0,get:v})},c.r=function(a){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(a,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(a,"__esModule",{value:!0})},c.t=function(a,p){if(1&p&&(a=c(a)),8&p||4&p&&typeof a=="object"&&a&&a.__esModule)return a;var v=Object.create(null);if(c.r(v),Object.defineProperty(v,"default",{enumerable:!0,value:a}),2&p&&typeof a!="string")for(var l in a)c.d(v,l,(function(U){return a[U]}).bind(null,l));return v},c.n=function(a){var p=a&&a.__esModule?function(){return a.default}:function(){return a};return c.d(p,"a",p),p},c.o=function(a,p){return Object.prototype.hasOwnProperty.call(a,p)},c.p="",c(c.s=0)}([function(y,m,c){c.r(m);var a=window,p=/^image\//,v=/\.\w+$/,l={},U={file:null,quality:.8,convertSize:2048e3,loose:!0,redressOrientation:!0},g=function(e){return typeof e=="function"},j=function(e){return p.test(e)};function x(e){e=Object.assign({},U,e),this.options=e,this.file=e.file,this.image=null,this.ParsedOrientationInfo=null,this.init()}var b=x.prototype;for(var O in m.default=x,b.init=function(){var e=this,i=this.file,n=this.options;i&&j(i.type)?(j(n.mimeType)||(n.mimeType=i.type),l.file2Image(i,function(t){g(e.beforeCompress)&&(e.image=t,i.width=t.naturalWidth,i.height=t.naturalHeight,e.beforeCompress(i)),i.type==="image/jpeg"&&n.redressOrientation?e.getParsedOrientationInfo(function(s){e.parsedOrientationInfo=s,e.rendCanvas()}):(e.parsedOrientationInfo={rotate:0,scaleX:1,scaleY:1},e.rendCanvas())},e.error)):e.error("请上传图片文件!")},b.rendCanvas=function(){var e=this,i=this.options,n=this.image,t=this.getExpectedEdge(),s=t.dWidth,d=t.dHeight,h=t.width,o=t.height,u=l.image2Canvas(n,s,d,e.beforeDraw.bind(e),e.afterDraw.bind(e),h,o);l.canvas2Blob(u,function(f){f&&(f.width=u.width,f.height=u.height),e.success(f)},i.quality,i.mimeType)},b.beforeCompress=function(){g(this.options.beforeCompress)&&this.options.beforeCompress(this.file)},b.getExpectedEdge=function(){var e,i=this.image,n=this.parsedOrientationInfo.rotate,t=this.options,s=i.naturalWidth,d=i.naturalHeight,h=Math.abs(n)%180==90;h&&(e=d,d=s,s=e);var o=s/d,u=Math.max(t.maxWidth,0)||1/0,f=Math.max(t.maxHeight,0)||1/0,w=Math.max(t.minWidth,0)||0,C=Math.max(t.minHeight,0)||0,L=Math.max(t.width,0)||s,I=Math.max(t.height,0)||d;u<1/0&&f<1/0?f*o>u?f=u/o:u=f*o:u<1/0?f=u/o:f<1/0&&(u=f*o),w>0&&C>0?C*o>w?C=w/o:w=C*o:w>0?C=w/o:C>0&&(w=C*o),I*o>L?I=L/o:L=I*o;var $=L=Math.floor(Math.min(Math.max(L,w),u)),M=I=Math.floor(Math.min(Math.max(I,C),f));return h&&(e=M,M=$,$=e),{dWidth:$,dHeight:M,width:L,height:I}},b.getParsedOrientationInfo=function(e){var i=this;this.getOrientation(function(n){g(e)&&e(i.parseOrientation(n))})},b.getOrientation=function(e){var i=this;l.file2ArrayBuffer(this.file,function(n){g(e)&&e(i.resetAndGetOrientation(n))})},b.resetAndGetOrientation=function(e){var i,n=new DataView(e);try{var t,s,d;if(n.getUint8(0)===255&&n.getUint8(1)===216)for(var h=n.byteLength,o=2;o+1<h;){if(n.getUint8(o)===255&&n.getUint8(o+1)===225){s=o;break}o+=1}if(s){var u=s+4,f=s+10;if(l.getStringFromCharCode(n,u,4)==="Exif"){var w=n.getUint16(f);if(((t=w===18761)||w===19789)&&n.getUint16(f+2,t)===42){var C=n.getUint32(f+4,t);C>=8&&(d=f+C)}}}if(d){var L;for(h=n.getUint16(d,t),L=0;L<h;L+=1)if(o=d+12*L+2,n.getUint16(o,t)===274){o+=8,i=n.getUint16(o,t),n.setUint16(o,1,t);break}}}catch(I){console.error(I),i=1}return i},b.parseOrientation=function(e){var i=0,n=1,t=1;switch(e){case 2:n=-1;break;case 3:i=-180;break;case 4:t=-1;break;case 5:i=90,t=-1;break;case 6:i=90;break;case 7:i=90,n=-1;break;case 8:i=-90}return{rotate:i,scaleX:n,scaleY:t}},b.beforeDraw=function(e,i){var n=this.parsedOrientationInfo,t=n.rotate,s=n.scaleX,d=n.scaleY,h=this.file,o=this.options,u="transparent",f=i.width,w=i.height;switch(h.size>o.convertSize&&o.mimeType==="image/png"&&(u="#fff",o.mimeType="image/jpeg"),e.fillStyle=u,e.fillRect(0,0,f,w),g(o.beforeDraw)&&o.beforeDraw.call(this,e,i),e.save(),t){case 90:e.translate(f,0);break;case-90:e.translate(0,w);break;case-180:e.translate(f,w)}e.rotate(t*Math.PI/180),e.scale(s,d)},b.afterDraw=function(e,i){var n=this.options;g(n.afterDraw)&&n.afterDraw.call(this,e,i)},b.error=function(e){var i=this.options;if(!g(i.error))throw new Error(e);i.error.call(this,e)},b.success=function(e){var i,n,t=this.options,s=this.file,d=this.image,h=this.getExpectedEdge(),o=d.naturalHeight,u=d.naturalWidth;if(e&&e.size)if(!t.loose&&e.size>s.size&&!(h.width>u||h.height>o))console.warn("当前设置的是非宽松模式，压缩结果大于源图片，输出源图片"),e=s;else{var f=new Date;e.lastModified=f.getTime(),e.lastModifiedDate=f,e.name=s.name,e.name&&e.type!==s.type&&(e.name=e.name.replace(v,(i=e.type,(n=j(i)?i.substr(6):"")==="jpeg"&&(n="jpg"),"."+n)))}else console.warn("图片压缩出了点意外，输出源图片"),e=s;g(t.success)&&t.success.call(this,e)},l.file2DataUrl=function(e,i,n){var t=new FileReader;t.onload=function(){i(t.result)},t.onerror=function(){g(n)&&n("读取文件失败！")},t.readAsDataURL(e)},l.file2ArrayBuffer=function(e,i,n){var t=new FileReader;t.onload=function(s){i(s.target.result)},t.onerror=function(){g(n)&&n("读取文件失败！")},t.readAsArrayBuffer(e)},l.getStringFromCharCode=function(e,i,n){var t,s="";for(n+=i,t=i;t<n;t+=1)s+=String.fromCharCode(e.getUint8(t));return s},l.file2Image=function(e,i,n){var t=new Image,s=a.URL||a.webkitURL;if(a.navigator&&/(?:iPad|iPhone|iPod).*?AppleWebKit/i.test(a.navigator.userAgent)&&(t.crossOrigin="anonymous"),t.alt=e.name,t.onerror=function(){g(n)&&n("图片加载错误！")},s){var d=s.createObjectURL(e);t.onload=function(){i(t),s.revokeObjectURL(d)},t.src=d}else this.file2DataUrl(e,function(h){t.onload=function(){i(t)},t.src=h},n)},l.url2Image=function(e,i,n){var t=new Image;t.src=e,t.onload=function(){i(t)},t.onerror=function(){g(n)&&n("图片加载错误！")}},l.image2Canvas=function(e,i,n,t,s,d,h){var o=document.createElement("canvas"),u=o.getContext("2d");return o.width=d||e.naturalWidth,o.height=h||e.naturalHeight,g(t)&&t(u,o),u.save(),u.drawImage(e,0,0,i,n),u.restore(),g(s)&&s(u,o),o},l.canvas2DataUrl=function(e,i,n){return e.toDataURL(n||"image/jpeg",i)},l.dataUrl2Image=function(e,i,n){var t=new Image;t.onload=function(){i(t)},t.error=function(){g(n)&&n("图片加载错误！")},t.src=e},l.dataUrl2Blob=function(e,i){for(var n=e.split(",")[1],t=e.match(/^data:(.*?)(;base64)?,/)[1],s=atob(n),d=n.length,h=new Uint8Array(d),o=0;o<d;o++)h[o]=s.charCodeAt(o);return new Blob([h],{type:i||t})},l.blob2DataUrl=function(e,i,n){this.file2DataUrl(e,i,n)},l.blob2Image=function(e,i,n){this.file2Image(e,i,n)},l.canvas2Blob=function(e,i,n,t){var s=this;HTMLCanvasElement.prototype.toBlob||Object.defineProperty(HTMLCanvasElement.prototype,"toBlob",{value:function(d,h,o){var u=this.toDataURL(h,o);d(s.dataUrl2Blob(u))}}),e.toBlob(function(d){i(d)},t||"image/jpeg",n||.8)},l.upload=function(e,i,n){var t=new XMLHttpRequest,s=new FormData;s.append("file",i),t.onreadystatechange=function(){if(t.readyState!==4||t.status!==200)throw new Error(t);n&&n(t.responseText)},t.open("POST",e,!0),t.send(s)},l)l.hasOwnProperty(O)&&(x[O]=l[O])}]).default})}(S)),S.exports}var D;function z(){return D||(D=1,k.exports=P()),k.exports}var H=z();function A(){return new URLSearchParams(window.location.search).get("category")}function q(r,E){const y=document.getElementById("content"),m=document.getElementById("page-title"),c=document.getElementById("project-section-description");fetch(E).then(a=>{if(!a.ok)throw new Error("Failed to fetch data.");return a.json()}).then(a=>{const p=a[r];if(!p)throw new Error(`Category "${r}" not found in data.`);m.textContent=r.charAt(0).toUpperCase()+r.slice(1),c&&(c.textContent=p.description||""),y.innerHTML="";const v=p.items;v&&v.length?v.forEach((l,U)=>{const g=document.createElement("div");g.classList.add("project-row"),g.innerHTML=`
            <div class="project-image">
              <img src="${l.image}" alt="${l.title}">
            </div>
            <div class="project-details">
              <p>${l.title}</p>
              <span class="project-client">${l.client||""}</span>
              <div class="project-meta">
                <p class="project-theme">${l.theme||""}</p>
                <p class="project-description">${l.description||""}</p>   
                <span class="project-type">${l.type?l.type.join(", "):""}</span>
              </div>
            </div>
          `,y.appendChild(g),console.log(`Rendering entry #${U}, applying compression.`);const j=g.querySelector(".project-image img");if(j.crossOrigin="anonymous",!j){console.warn("No image element found in section:",g);return}console.log("Processing image:",j.src),fetch(j.src,{mode:"cors"}).then(x=>(console.log("Fetched image blob"),x.blob())).then(x=>{console.log("Blob ready, size:",x.size);const O={file:new File([x],"image.jpg",{type:x.type}),quality:.6,convertSize:1/0,redressOrientation:!0,beforeCompress(e){console.log("BeforeCompress:",e.size,e.type)},success(e){console.log("Compression success:",e.size,e.type),j.src=URL.createObjectURL(e);const i=(originalSize-compressedSize)/originalSize*100;console.log("Original size:",originalSize,"bytes"),console.log("Compressed size:",compressedSize,"bytes"),console.log("Compression reduced size by:",i.toFixed(2)+"%")},error(e){console.error("Compression error:",e)}};new H.ImageCompressor(O)}).catch(x=>console.error("Fetch error during compression:",x)),g.addEventListener("click",()=>{R(g,l)})}):y.innerHTML=`<p>No content found for "${r}".</p>`}).catch(a=>{console.error("Error:",a),y.innerHTML="<p>Error loading content.</p>"})}document.addEventListener("DOMContentLoaded",()=>{const r=A();r?q(r,"/data/data.json"):document.getElementById("content").innerHTML="<p>Invalid category.</p>",document.getElementById("grid-view").addEventListener("click",()=>{const m=document.querySelector(".projects-container");m.classList.add("row-view"),m.classList.remove("list-view"),document.getElementById("grid-view").classList.add("active"),document.getElementById("list-view").classList.remove("active")}),document.getElementById("list-view").addEventListener("click",()=>{const m=document.querySelector(".projects-container");m.classList.add("list-view"),m.classList.remove("row-view"),document.getElementById("list-view").classList.add("active"),document.getElementById("grid-view").classList.remove("active")}),document.querySelectorAll("#category-buttons button[data-category]").forEach(m=>{m.addEventListener("click",()=>{const c=m.dataset.category;!c||c==="filter"||y(c)})});function y(m){const c=`/pages/projects.html?category=${encodeURIComponent(m)}`;typeof window.loadPage=="function"?window.loadPage(c):window.location.href=c}});
